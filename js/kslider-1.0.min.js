(function(a){a.fn.kslider=function(b){function d(a,b){return Math.max.apply(Math,a.map(function(){if(b)return a.outerWidth(true);else return a.outerHeight(true)}).get())}function e(){return b}var c=a(this);c.append('<img class="kloading" src="http://dev.kevingermain.com/kslider/img/loading.gif">');c.css("display","inline-block");a("div",c).hide();a(window).load(function(){function v(a,c){var d=g.eq(a);d.fadeOut(b.speed);if(c==1){if(d.next().length==0){n.eq(a).fadeTo(b.speed/2,b.opacity);n.first().fadeTo(b.speed,1);g.first().fadeIn(b.speed);if(q>b.width)s=0}else{d.next().fadeIn(b.speed);n.eq(a).fadeTo(b.speed/2,b.opacity);n.eq(a+1).fadeTo(b.speed,1);var e=-(r[a]+(n.eq(a+1).outerWidth(true)-b.width)/2);if(e<-(q-b.width))s=-(q-b.width);else if(e<0)s=e;else if(e>0)s=0}}else{if(d.prev().length==0){n.eq(a).fadeTo(b.speed/2,b.opacity);n.last().fadeTo(b.speed,1);g.last().fadeIn(b.speed);if(q>b.width)s=b.width-q}else{d.prev().fadeIn(b.speed);n.eq(a).fadeTo(b.speed/2,b.opacity);n.eq(a-1).fadeTo(b.speed,1);var e=-(r[a-2]+(n.eq(a-1).outerWidth(true)-b.width)/2);if(e<-(q-b.width))s=-(q-b.width);else if(e<0)s=e;else if(e>0)s=0}}}a(".kloading").remove();a("div",c).show();var f=a("div:eq(0)",c).addClass("kbig");var g=a(".kbig img",c);var h=d(g,false);var i=d(g,true);var j=0,k=0,l=0;if(a("div:eq(1)",c).length==0){f.clone().appendTo(c);a("div:eq(1)",c).removeClass().addClass("ksmall");j=h/4;k=i/4;l=1}else{a("div:eq(1)",c).removeClass().addClass("ksmall");j=d(a("div:eq(1) img",c),false);k=d(a("div:eq(1) img",c),true)}var m=a(".ksmall",c);m.wrap("<div style='overflow:hidden;'></div>").css("cursor","pointer");var n=a(".ksmall img",c);var o={width:i,height:h,widthThumb:k,heightThumb:j,speed:500,sameSize:false,opacity:.4,nav:true};if(e())b=a.extend(o,e());else b=a.extend(o,b);var p=n.outerWidth(true)-n.width();g.not(":first-child").hide();a(".kbig img:first-child",c).css("display","block");c.css({width:b.width,height:b.height+b.heightThumb});f.css({height:b.height,width:b.width});g.css({width:"auto",height:"auto","max-width":b.width,"max-height":b.height,position:"absolute",cursor:"pointer"});g.map(function(){a(this).css({"margin-top":(b.height-a(this).outerHeight())/2,"margin-bottom":(b.height-a(this).outerHeight())/2,"margin-right":(b.width-a(this).outerWidth())/2,"margin-left":(b.width-a(this).outerWidth())/2})});var q=0,r=[];n.css({width:"auto",height:"auto","max-width":b.widthThumb-p,"max-height":b.heightThumb-p,opacity:b.opacity,"float":"left"}).map(function(c){if(b.sameSize)q+=b.widthThumb;else q+=a(this).outerWidth(true);r[c]=q;var d=b.heightThumb-a(this).outerHeight(true);var e=b.widthThumb-a(this).outerWidth(true);if(d>0)a(this).css({"padding-top":d/2,"padding-bottom":d/2});if(e>0&&b.sameSize)a(this).css({"padding-right":e/2,"padding-left":e/2})});a(".ksmall img:first-child",c).css("opacity","1");if(q<b.width)m.css({width:b.width,height:b.heightThumb,"padding-left":(b.width-q)/2+p*2});else m.css({width:q+2,height:b.heightThumb});if(b.nav){c.append('<div class="kleft"></div><div class="kright"></div>');a(".kleft, .kright",c).css({"border-color":"transparent #777 transparent transparent",cursor:"pointer",display:"inline-block","border-style":"solid",position:"relative","float":"left",left:"-42px","margin-top":-b.heightThumb,"border-width":b.heightThumb/2+"px 21px"});a(".kright",c).css({"border-color":"transparent transparent transparent #777","float":"right",left:"auto",right:"-42px"})}var s=0,t=0;var u=0;m.mousemove(function(a){t=a.pageX-c.offset().left;if(t<30)t=0;else if(t>b.width-30)t=b.width;s=-t/(b.width/(q-b.width))});if(t<b.width&&q>b.width){setInterval(function(){u+=(s-u)/8;m.css({"margin-left":u})},10)}n.hover(function(){a(this).fadeTo(b.speed,1)},function(){if(!g.eq(a(this).index()).is(":visible"))a(this).stop(true,true).fadeTo(b.speed/2,b.opacity)});a(".kbig img, .kright",c).on("click",function(){v(a(".kbig img:visible",c).index(),1)});a(".kleft",c).on("click",function(){v(a(".kbig img:visible",c).index(),0)});n.on("click",function(){var c=a(this).index();if(!g.eq(c).is(":visible")){g.fadeOut(b.speed);n.not(this).fadeTo(b.speed,b.opacity)}g.eq(c).fadeIn(b.speed)})})}})(jQuery)