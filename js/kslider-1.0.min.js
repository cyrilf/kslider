(function(a){a.fn.kslider=function(b){function e(a,b){return Math.max.apply(Math,a.map(function(){if(b)return a.outerWidth(true);else return a.outerHeight(true)}).get())}function s(d,e){var f=a(".kbig img",c).eq(d);f.fadeOut(b.speed);if(e==1){if(f.next().length==0){a(".ksmall img",c).eq(d).fadeTo(b.speed/2,b.opacity);a(".ksmall img",c).first().fadeTo(b.speed,1);a(".kbig img",c).first().fadeIn(b.speed);if(n>b.width)p=0}else{f.next().fadeIn(b.speed);a(".ksmall img",c).eq(d).fadeTo(b.speed/2,b.opacity);a(".ksmall img",c).eq(d+1).fadeTo(b.speed,1);var g=-(o[d]+(a(".ksmall img",c).eq(d+1).outerWidth(true)-b.width)/2);if(g<-(n-b.width))p=-(n-b.width);else if(g<0)p=g;else if(g>0)p=0}}else{if(f.prev().length==0){a(".ksmall img",c).eq(d).fadeTo(b.speed/2,b.opacity);a(".ksmall img",c).last().fadeTo(b.speed,1);a(".kbig img",c).last().fadeIn(b.speed);if(n>b.width)p=b.width-n}else{f.prev().fadeIn(b.speed);a(".ksmall img",c).eq(d).fadeTo(b.speed/2,b.opacity);a(".ksmall img",c).eq(d-1).fadeTo(b.speed,1);var g=-(o[d-2]+(a(".ksmall img",c).eq(d-1).outerWidth(true)-b.width)/2);if(g<-(n-b.width))p=-(n-b.width);else if(g<0)p=g;else if(g>0)p=0}}}var c=a(this);var d=a("div:eq(0)",c).addClass("kbig");var f=e(a(".kbig img",c),false);var g=e(a(".kbig img",c),true);var h=0,i=0,j=0;if(a("div:eq(1)",c).length==0){d.clone().appendTo(c);a("div:eq(1)",c).removeClass().addClass("ksmall");h=f/4;i=g/4;j=1}else{a("div:eq(1)",c).removeClass().addClass("ksmall");h=e(a("div:eq(1) img",c),false);i=e(a("div:eq(1) img",c),true)}a(".ksmall",c).wrap("<div style='overflow:hidden;'></div>");var k={width:g,height:f,widthThumb:i,heightThumb:h,nbImage:a(".kbig img",c).length,speed:500,sameArea:false,opacity:.4,nav:true};var b=a.extend(k,b);var l=a(".ksmall",c).css("cursor","pointer");var m=a(".ksmall img",c).outerWidth(true)-a(".ksmall img",c).width();a(".kbig img",c).not(":first-child").hide();c.css({width:b.width,height:b.height+b.heightThumb});d.css({height:b.height,width:b.width});a(".kbig img",c).css({width:"auto",height:"auto","max-width":b.width,"max-height":b.height,position:"absolute",cursor:"pointer"});a(".kbig img",c).map(function(){a(this).css({"margin-top":(b.height-a(this).outerHeight())/2,"margin-bottom":(b.height-a(this).outerHeight())/2,"margin-right":(b.width-a(this).outerWidth())/2,"margin-left":(b.width-a(this).outerWidth())/2})});var n=0,o=[];a(".ksmall img",c).css({width:"auto",height:"auto","max-width":b.widthThumb-m,"max-height":b.heightThumb-m,opacity:b.opacity,"float":"left"}).map(function(c){if(b.sameArea)n+=b.widthThumb;else n+=a(this).outerWidth(true);o[c]=n;var d=b.heightThumb-a(this).outerHeight(true);var e=b.widthThumb-a(this).outerWidth(true);if(d>0)a(this).css({"padding-top":d/2,"padding-bottom":d/2});if(e>0&&b.sameArea)a(this).css({"padding-right":e/2,"padding-left":e/2})});a(".ksmall img:first-child",c).css("opacity","1");if(n<b.width)l.css({width:b.width,height:b.heightThumb,"padding-left":(b.width-n)/2+m*2});else l.css({width:n+2,height:b.heightThumb});if(b.nav){c.append('<div class="kleft"></div><div class="kright"></div>');a(".kleft, .kright",c).css({"border-color":"transparent #777 transparent transparent",cursor:"pointer","border-style":"solid",position:"relative","float":"left",left:"-42px","margin-top":-b.heightThumb,"border-width":b.heightThumb/2+"px 21px"});a(".kright",c).css({"border-color":"transparent transparent transparent #777","float":"right",left:"auto",right:"-42px"})}ksmallimg=a(".ksmall img",c);var p=0,q=0;var r=0;l.mousemove(function(a){q=a.pageX-c.offset().left;if(q<30)q=0;else if(q>b.width-30)q=b.width;p=-q/(b.width/(n-b.width))});if(q<b.width&&n>b.width){setInterval(function(){r+=(p-r)/8;l.css({"margin-left":r})},10)}ksmallimg.hover(function(){a(this).fadeTo(b.speed,1)},function(){if(!a(".kbig img",c).eq(a(this).index()).is(":visible"))a(this).stop(true,true).fadeTo(b.speed/2,b.opacity)});a(".kbig img, .kright",c).on("click",function(){s(a(".kbig img:visible",c).index(),1)});a(".kleft",c).on("click",function(){s(a(".kbig img:visible",c).index(),0)});ksmallimg.on("click",function(){var d=a(this).index();if(!a(".kbig img",c).eq(d).is(":visible")){a(".kbig img",c).fadeOut(b.speed);a(".ksmall img",c).not(this).fadeTo(b.speed,b.opacity)}a(".kbig img",c).eq(d).fadeIn(b.speed)})}})(jQuery)