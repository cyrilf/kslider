(function(a){a.fn.kslider=function(b){var c=a(this);var d=a("div:eq(0)",c).addClass("kbig");var e=Math.max.apply(Math,a(".kbig img",c).map(function(){return a(this).height()}).get());var f=Math.max.apply(Math,a(".kbig img",c).map(function(){return a(this).width()}).get());var g=0;var h=0;if(a("div:eq(1)",c).length==0){d.clone().appendTo(c);g=e/4;h=f/4}else{g=Math.max.apply(Math,a("div:eq(1) img",c).map(function(){return a(this).height()}).get());h=Math.max.apply(Math,a("div:eq(1) img",c).map(function(){return a(this).width()}).get())}var i=a("div:eq(1)",c).removeClass().addClass("ksmall");var j={width:f,height:e,widthThumb:h,heightThumb:g,nbImage:a("div:eq(0) img",c).length,speed:750,sameArea:true};var b=a.extend(j,b);a(".kbig img",c).not(":first-child").hide();c.css({width:b.width,height:b.height+b.heightThumb});d.css({height:b.height,width:b.width});a(".kbig img",c).css({width:"auto",height:"auto","max-width":b.width,"max-height":b.height});a(".kbig img",c).map(function(){var c=b.height-a(this).height();var d=b.width-a(this).width();if(c==0);a(this).css({"margin-top":c/2,"margin-bottom":c/2,"margin-right":d/2,"margin-left":d/2})});var k=0;a(".ksmall img",c).css({width:"auto",height:"auto","max-width":b.widthThumb,"max-height":b.heightThumb});a(".ksmall img",c).map(function(){if(b.sameArea)k+=b.widthThumb;else k+=a(this).width();var c=b.heightThumb-a(this).height();var d=b.widthThumb-a(this).width();if(c>0)a(this).css({"padding-top":c/2,"padding-bottom":c/2});if(d>0&&b.sameArea)a(this).css({"padding-right":d/2,"padding-left":d/2})});if(k<b.width)i.css({width:b.width,height:b.heightThumb,"padding-left":(b.width-k)/2});else i.css({width:k,height:b.heightThumb});c.append('<div style="" class="kleft"></div><div style="" class="kright"></div>');ksmallimg=a(".ksmall img",c);kbigimg=a(".kbig img",c);i.mousemove(function(d){var e=d.pageX-c.offset().left;var f=-e/(b.width/(k-b.width));if(e<b.width&&k>b.width)a(this).css("margin-left",f)});ksmallimg.hover(function(){a(this).animate({opacity:1},500,"swing")},function(){if(!a(".kbig img",c).eq(a(this).index()).is(":visible"))a(this).stop(true,true).animate({opacity:.5},300,"swing")});a(".kbig img",c).on("click",function(){var d=a(this).index();a(this).fadeOut(b.speed);if(a(this).next().length==0){a(".kbig img",c).first().fadeIn(b.speed);a(".ksmall img",c).eq(d).animate({opacity:.5},300,"swing");a(".ksmall img",c).first().animate({opacity:1},500,"swing");if(k>b.width)i.animate({marginLeft:0},500)}else{a(this).next().fadeIn(b.speed);a(".ksmall img",c).eq(d).animate({opacity:.5},300,"swing");a(".ksmall img",c).eq(d+1).animate({opacity:1},500,"swing");var e=(b.width-k)/b.nbImage*(d+2);if(e<-b.widthThumb*(d+1))e=-b.widthThumb*d;if(k>b.width)i.animate({marginLeft:e},500)}});ksmallimg.on("click",function(){var d=a(this).index();if(!a(".kbig img",c).eq(d).is(":visible")){a(".kbig img",c).fadeOut(b.speed);a(".ksmall img",c).not(this).animate({opacity:.5},500,"swing")}a(".kbig img",c).eq(d).fadeIn(b.speed)})}})(jQuery)